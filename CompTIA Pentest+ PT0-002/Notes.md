## 0. General Organisational Security 
  - Logical/Technical: UTM, SIEM, MDM, IPS/IDS, NGFW, EDR, Encryption, MFA, VPN, Automatic Updates, Enforced AD and Cloud policies. 
  - Physical: Barriers, Fencing, Mantraps, Bollards, Door Locks/KeyFobs, Security Gaurds, CCTV
  - Planning/Prep/Response: Test backups and other DRP measures, emulate small disasters, training/awareness. IR may become easier to manage if an incident were to occur.

## 1. Planning and Scoping
   - Rules of Engagement: Scope clearly written in a document as to what testing and assets are in-scope and OOS which is signed by the company and pentesting team.
   - NDA (Non-disclosure agreement): A contract that states that any findings remain between both parties and not made to the general public. Breaking the NDA can lead to legal consequences.
   - Budget/Resources: If the company has enough budget to fund resources and the pentest.
   - Timing: Duration of testing, maybe weeks, months, etc.
   - Stakeholders: What parties and inviduals are involved during testing.
   - Scope of assets: What assets are allowed to be tested. Internal, external, cloud, network, web services, etc.
   - Legality and Compliance: Ensure all pentesting is under law and authorised testing.
   - Communication: How will the teams communicate with each other and protocols used.
   - Location Restrictions: Interfere with Communications and physcial security testing.
   - Statement Of Work: States the work that needs to be completed
 - Compliance Requirements
     - GDPR: To protect customer data and comply with privacy. Also, for security and lowering chances of data theft.
     - PCI DSS: To secure payment transactions. 1-3 levels, 1 being the highest level of security.
     - HIPPA: Healthcare and medical data, could include patients or related to a hospital.
 
## 2. Recon/Information Gathering and Vulnerability Scanning
   - Passive Recon: Not engaging with the target.
     - Tools: Harvester, subfinder, crt.sh, crunchbase, BGP Toolkit, Shodan, FOFA, Whois, Censys, dig, spiderfoot, wappalyzer, Maltego, etc
     - OSINT: Scrape all online profiles and publicly available data on the company and employees. (Might Leads PII, SE, etc) 
     - Dorking: Using dorking techniques to find more assets and sensitive info of a company.
     - Github/Gitlab: Grep for keywords such as "Company name" "API", "secret", "oauth", "pass", "database" for leaks
     - Tech discovery and fingerprinting: Identify any external tech and cloud assets with wappalyzer.
     - JavaScript code: More endpoints and urls.
     - Cloud assets: S3 buckets, Azure blobs, subdomains, Public google drive folders and docs. 
   - Active Recon: Engage with the target.
     - Portscanning: Nmap - Scan ports, the SYN/ACK connection will be active between attacker and target system.
     - Network traffic: Capture requests, sniff packets, API's, etc via Wireshark.
     - Dir and files fuzzing: Use ffuf and katana to discover more web assets
     - Active Subdomain enum and more assets: Amass, tldfinder, PureDNS, Katana, MassDNS, FFUF, Dnsx, ASNmap, AltDNS
   - Vulnerability Scanning: To potentially identify vulnerabilties and flaws with a scanner
     - Tools: Nikto, Acuentix web vulnerability scanner, Nessus, Recon-NG, OpenVAS, GVM, ReconFTW, etc.
         - Helps identify potential CVE's that can be exploited.
   - [Recon like an adversary](https://www.youtube.com/watch?v=nGs8pWIj5k4)
   - [Modern Adversarial Recon](https://www.youtube.com/watch?v=N_Qyx836Y9s)
   - [The Bug Hunter's Methodology v4.0 - Jason Haddix](https://www.youtube.com/watch?v=p4JgIu1mceI)
   - [HackTricks](https://book.hacktricks.wiki/en/generic-methodologies-and-resources/external-recon-methodology/index.html)

## 3. Attacks and Exploits to Gain and Maintain Access
  - Web-Based Attacks Examples:
     - XSS: Javascript Execution on parameter such as ```?q=<script>prompt(1)</script>``` - Needs to be sent to victim (RXSS, SXSS, DOMXSS, MXSS)
     - Injection: SQLi, XXE, LDAP, OS Command Injection, SSTI, SSRF, Host Header, Xpath injection  
     - Access control: Authentication/Authrization, IDOR, API, logic flaws, race conditions bugs, etc.
     - Web cache poisoning/deception: Cache content on CDN's can lead to DoS, Access control bypass, etc.  
     - API: Abusing REST and GraphQL for access control and Injection attacks.
     - Javascript obfus/deobfuscation: Uncover client/server-side vulnerabilities, info leaks, secrets, etc.
     - CORS/CSRF: Allows attacker to take advantage by sending site data to their domain or perform senstive actions.
     - LLM attacks: Bugs found in AI, leading to extracting sensitive information, injecting payloads, etc.
     - Cloud-Based attacks: AWS, GCP, Azure misconfigs that can lead to massive amount of information stolen.  
     - Insecure deserialization, HTTP-Pipelining, Parameter Pollution, prototype pollution, Oauth.
     - [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
     - [Hacktricks web](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/index.html)
     - [Hacktricks for bug hunters](https://book.hacktricks.wiki/en/pentesting-web/web-vulnerabilities-methodology.html) 
  - Network-Based Attacks:
     - Man-in-the-Middle (MitM): Intercepting communication between two parties (e.g., ARP poisoning).
     - DOS/DDOS: Flooding the target with traffic to render services unusable.
     - Packet Sniffing: Capturing data packets flowing through the network (e.g., Wireshark, tcpdump).
     - DNS Spoofing: Redirecting traffic to a malicious site by corrupting the DNS cache.
     - Rogue Access Points: Setting up a fake Wi-Fi hotspot to intercept traffic.
     - Wireless attacks: Wi-Fi jamming, deauthentication, bluetooth exploits and cracking - airdump-ng, aircrack-ng, bluestrike.
     - Open ports/services: Enumeration with nmap and exploitation of open ports such as LDAP, AD, SMB
  - CVE-Based Attacks:
     - Exploit PoCs based on publicly available CVE's: Companies vulnerable can be found through Shodan and FOFA search engines if they use outdated software.
     - 0-Days: These are unknown vulnerablities in systems, mostly vendors, if exploited can turn into a CVE.
  - Physical Attacks:
     - Social Engineering: Tricking, manipulating someone into giving certain/sensitive information or performing actions (Can be in real-life or social media). Tools like SET can also help. Phising, Pretexting, Baiting
     - Dumpster-Diving: Finding documents and information in trash and weird places.
     - Hardware-Based Attacks: Bad USB's that can have malware or infostealers, when plugged in, can cause harm to computers such as encrypt files or steal data. Install Keyloggers to act as spyware to rob user credentials. Skimmers at ATM's to steal cc info which can be used for cloned cards, although, this is an old method and Banks have more detection/protection against these attacks.
     - Physical theft and tampering: Stealing devices, tampering with physical security measures such as locks, RFID card readers to bypass physical security entry points.
     - Insider Threats: Could be intentional or accidental by users such as leaking passwords, exfiltrating data, etc.
  - IoT Attacks:
     - Botnets: Taking over Internet of Things (IoT) devices and using them for attacks (e.g., Mirai botnet).
     - Default Password Exploits: Many IoT devices are shipped with weak or default passwords, making them easy targets.
     - Firmware Exploits: Attacking vulnerabilities in IoT firmware to gain control.
  - Maintain Access:
     - Backdoors: Web shells, and other executables that can connect to the system remotely such as malicious php shells.
     - Scheduled Tasks: Running Cron jobs or Win Task Scheduler at specific times/reboots to run payloads/malware repeatedly that connects back remotely.
     - Abusing Services: SSH, RDP, VPN, FTP
     - Command and Control: Establish communication channels and maintain access using different tools and techniques such as Colbalt strike, Havoc, etc.
     - DLL Injection or Hijacking: replace legitimate DLLs with malicious ones, which are loaded by legitimate applications or inject into ones that are already running
     - Abusing Cloud Services: AWS can allow an attacker to change settings and permissions to maintain access. Azure can lead to AD compromise. [Pacu](https://github.com/RhinoSecurityLabs/pacu) for AWS bruteforcing permissions
     - Browser Extensions: Install malicious browser extensions that allows them to steal browser session cookies, creds over a period of time.
     - Post-exploit and privilege escalation activities: 
        - Windows: Refer to post-exploit/priv escalation labs for Windows. [Winpeas](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS) for automation.
        - Linux: Credential hunting (~/.ssh, env, history), SUID, cron jobs, symbolic links, CVE for kernal exploits, ```sudo -l```, vulnerable services. [Linpeas](https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS) for automation.

## 3.5 Covering Tracks and basic opsec
- Linux: [Cover tracks on Linux](https://null-byte.wonderhowto.com/how-to/clear-logs-bash-history-hacked-linux-systems-cover-your-tracks-remain-undetected-0244768/)
  - Log Files - ```rm -rf /var/log/*```
  - Clearing bash history - ```cat /dev/null > ~/.bash_history && history -c && exit```
  - Automated tooling > [covermyass](https://github.com/sundowndev/covermyass)
- Windows:
  - Clear all Windows event logs (Powershell Admin) - ```wevtutil el | ForEach-Object {wevtutil cl $_}```
  - Clear all Windows event logs (CMD Admin) - ```for /F "tokens=*" %1 in ('wevtutil.exe el') DO wevtutil.exe cl "%1"```
  - Disable Windows Defender (Powershell Admin) - ```Set-MpPreference -DisableRealtimeMonitoring $true```
  - Prevent Powershell logging (Powershell) - ```[System.IO.File]::WriteAllText("$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt", "")```
- Attacker Setup:
  - Second-hand Disposable machine/OS: Mac changer, Custom DNS server, VPN or Proxychains.
  - Route all traffic to Whonix gateway.
  - Burner Phone in case usage.    
  - Physical measures for Physical pentesting.
  - Advanced - Encrypted C2 (command and control) beacon traffic, malleable profiles.  

## 4. Reporting and Communication

## 5. Tools and Code Analysis 

## Other Important Notes:

- Pentesting Guides, Practices and Frameworks. 
    - OWASP: Web application, API and Mobile Security
    - NIST: A framework of security, they also have a list for CVE's in detail
    - MITRE Att&ck: An attack framework that makes up for a matrix with a list of methods and techniques used by attackers to conduct a better pentest and exploit vulnerabilties.

- Risk = Threats * Vulnerabilties
    - Risk: What is the Risk Tolerance of the Company losing data or Business harm? - Risk increases on threat and vulnerability.
    - Threat: To exploit a vulnerability
    - Vulnerability: To identify a weakness or flaw that can be exploited.
  
