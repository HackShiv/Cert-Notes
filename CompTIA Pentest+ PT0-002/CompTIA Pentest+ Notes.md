CompTIA Pentest+ Notes

General Organisational Security 
 - Logical/Technical Sec: UTM, SIEM, MDM, IPS/IDS, NGFW, EDR, Encryption, MFA, VPN, Automatic Updates, Enforced AD and Cloud policies. 
 - Physical Sec: Barriers, Fencing, Mantraps, Bollards, Door Locks/KeyFobs, Security Gaurds, CCTV
 - Planning/Prep/Response: Test backups and other DRP measures, emulate small disasters, training/awareness. IR may become easier to manage if an incident were to occur. Setting up proper Accounting/Logging is also important to identify attackers.

1. Planning and Scoping
     - When the pentest team, company and other involved stakeholders outline the details of the engagement. 
     - Rules of Engagement: Scope clearly written in a document as to what testing and assets are in-scope and OOS which is signed by the company and pentesting team.
     - NDA (Non-disclosure agreement): A contract that states that any findings remain between both parties and not made to the general public. Breaking the NDA can lead to legal consequences.
     - Budget/Resources: If the company has enough budget to fund resources and the pentest.
     - Timing: Duration of testing, maybe weeks, months, etc.
     - Stakeholders: What parties and inviduals are involved during testing.
     - Scope of assets: What assets are allowed to be tested. Internal, external, cloud, network, web services, etc.
     - Legality and Compliance: Ensure all pentesting is under law and authorised testing.
     - Communication: How will the teams communicate with each other and protocols used.
     - Location Restrictions: Interfere with Communications and physcial security testing.
     - Cloud Assets: Test SaaS, PaaS and IaaS infrastructures.
     - Statement Of Work: States the work that needs to be completed
  Compliance Requirements
     - GDPR: To protect customer data and comply with privacy. Also, for security and lowering chances of data theft.
     - PCI DSS: To secure payment transactions. 1-3 levels, 1 being the highest level of security.
     - HIPPA: Healthcare and medical data, could include patients or related to a hospital.
 
2. Recon/Information Gathering and Vulnerabilty Scanning
  Passive Recon: Not engaging or interacting with the target
     - Tools: Harvester, subfinder, crunchbase, BGP Toolkit, Shodan, FOFA, Whois, dig, spiderfoot, wappalyzer, Maltego, etc
     - OSINT: Scrape all online profiles and publicly available data on the company and employees. (Might Leads PII, SE, etc) 
     - Dorking: Using dorking techniques to find more assets and sensitive info of a company.
     - Tech discovery and fingerprinting: Identify any external tech and cloud assets with wappalyzer.
     - JavaScript code: May lead to more endpoints and urls. 
  Active Recon: Engage and interact with the target
     - Tools: Nmap, ping, PureDNS, Katana web crawler, FFUF, MassDNS, subfinder etc.
     - Portscanning: Scan ports, the SYN/ACK connection will be active between attacker and target system.
     - Network traffic: Capture requests, sniff packets, API's, etc.
     - Dir and files fuzzing: Use ffuf and katana to discover more web assets
     - Subfinder: Find subdomains
  Vulnerabilty Scanning: To potentially identify vulnerabilties and flaws with a scanner
     - Tools: Nikto, Acuentix web vulnerabilty scanner, Nessus, Recon-NG, etc.
        Helps identify potential CVE's that can be exploited.

3. Attacks and Exploits to Gain and Maintain Access
  Web-Based Attacks Examples:
     - XSS: Javascript Execution on parameter such as ?q=<script>prompt(1)</script> - Needs to be sent to victim (RXSS, SXSS, DOMXSS, MXSS)
     - SQLI: Extract dbs, columns and tables. '1 UNION SELECT ALL 1,2 '1. sqlmap and ghauri  
     - Access control: Authentication/Authrization, IDOR, API, logic flaws, race conditions bugs, etc.
     - Web cache poisoning: On sensitive endpoints, you can trick victims into clicking something which lasts, can lead to ATO.
     - CORS/CSRF: Allows attacker to take advantage by sending site data to their domain or perform senstive actions.
     - LLM attacks: Bugs found in AI, leading to extracting sensitive information, injecting payloads, etc.
     - Cloud-Based attacks: AWS, GCP Google misconfigs that can lead to massive amount of information stolen.  
     - SSRF, SSTI, Insecure deserialization, Host header injection and other types of bugs on portswigger academy.
  Network-Based Attacks Examples:
     - Man-in-the-Middle (MitM): Intercepting communication between two parties (e.g., ARP poisoning).
     - DOS/DDOS: Flooding the target with traffic to render services unusable.
     - Packet Sniffing: Capturing data packets flowing through the network (e.g., Wireshark, tcpdump).
     - DNS Spoofing: Redirecting traffic to a malicious site by corrupting the DNS cache.
     - Rogue Access Points: Setting up a fake Wi-Fi hotspot to intercept traffic.
     - Wireless attacks: Wi-Fi jamming, deauthentication, bluetooth exploits and cracking - airdump-ng, aircrack-ng, bluestrike.
  CVE-Based Attacks:
     - Exploit PoCs based on publicly available CVE's: Companies vulnerable can be found through Shodan and FOFA search engines if they use outdated software.
     - 0-Days: These are unknown vulnerablities in systems, mostly vendors, if exploited can turn into a CVE.
  Physical Attacks Examples:
     - Social Engineering: Tricking, manipulating someone into giving certain/sensitive information or performing actions (Can be in real-life or social media). Tools like SET can also help. Phising, Pretexting, Baiting
     - Dumpster-Diving: Finding documents and information for example in trash, boxes and in weird places. Happens alot in real life, and some organisations like the NHS have been breached like this.
     - Hardware-Based Attacks: Bad USB's that can have malware or infostealers, when plugged in, can cause harm to computers such as encrypt files or steal data. Install Keyloggers to act as spyware to rob user credentials. Skimmers at ATM's to steal cc info which can be used for cloned cards, although, this is an old method and Banks have more detection/protection against these attacks.
     - Physical theft and tampering: Stealing devices, tampering with physical security measures such as locks, RFID card readers to bypass physical security entry points.
     - Insider Threats: Could be intentional or accidental by users such as leaking passwords, exfiltrating data, etc.
  IoT Attacks:
     - Botnets: Taking over Internet of Things (IoT) devices and using them for attacks (e.g., Mirai botnet).
     - Default Password Exploits: Many IoT devices are shipped with weak or default passwords, making them easy targets.
     - Firmware Exploits: Attacking vulnerabilities in IoT firmware to gain control.
 Maintain Access
  Backdoors: Web shells, and other executables that can connect to the system remotely such as malicious php shells.
  Scheduled Tasks: Running Cron jobs or Win Task Scheduler at specific times/reboots to run payloads/malware repeatedly that connects back remotely.
  Abusing Services: SSH, RDP, VPN, FTP
  Command and Control: Establish communication channels and maintain access using different tools and techniques.
  DLL Injection or Hijacking: replace legitimate DLLs with malicious ones, which are loaded by legitimate applications or inject into ones that are already running
  Abusing Cloud Services: Misconfigured AWS can allow an attacker after login to change settings and permissions to maintain access.
  Browser Extensions: Install malicious browser extensions that allows them to steal browser session cookies, creds over a period of time.

3.5 Covering Tracks and OPSEC

4. Reporting and Communication

5. Tools and Code Analysis 


Other Important Notes

NIST, OWASP, MITRE Attack Framework - Pentesting Guides and Practices. 
     OWASP: Web application, API and Mobile Security
     NIST: A framework of security, they also have nvd for CVE's in detail
     MITRE Att&ck: An attack framework that makes up for a matrix with a list of methods and techniques used by attackers to conduct a better pentest and exploit vulnerabilties.

Risk = Threats * Vulnerabilties
     Risk: What is the Risk Tolerance of the Company losing data or Business harm? - Risk increases on threat and vulnerabilty.
     Threat: To exploit a vulnerability
     Vulnerabilty: To identify a weakness or flaw that can be exploited.
